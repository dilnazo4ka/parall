#include <bits/stdc++.h>              // подключаю все стандартные C++ библиотеки
#include <omp.h>                      // подключаю библиотеку OpenMP
using namespace std;                  // использую пространство имён std

int main(){                            // точка входа в программу
  const int N = 10000000;              // размер массива данных
  vector<double> a(N);                 // объявляю массив из N элементов типа double

  for(int i = 0; i < N; i++)           // цикл инициализации массива
    a[i] = double(i % 100);            // заполняю массив значениями от 0 до 99

  double t_seq1 = omp_get_wtime();     // фиксирую время начала последовательной части

  double seq_sum = 0.0;                // объявляю переменную для последовательной суммы
  for(int i = 0; i < N; i++)           // последовательный проход по массиву
    seq_sum += a[i];                   // накапливаю сумму элементов

  double t_seq2 = omp_get_wtime();     // фиксирую время окончания последовательной части
  double seq_time = t_seq2 - t_seq1;   // вычисляю время последовательного выполнения

  double par_sum = 0.0;                // переменная для параллельной суммы
  double par_sq  = 0.0;                // переменная для суммы квадратов элементов

  double t_par1 = omp_get_wtime();     // фиксирую время начала параллельной части

  #pragma omp parallel for reduction(+:par_sum, par_sq) // распараллеливаю цикл с редукцией
  for(int i = 0; i < N; i++){           // параллельный проход по массиву
    par_sum += a[i];                    // добавляю элемент в общую сумму
    par_sq  += a[i] * a[i];             // добавляю квадрат элемента
  }

  double t_par2 = omp_get_wtime();     // фиксирую время окончания параллельной части
  double par_time = t_par2 - t_par1;   // вычисляю время параллельного выполнения

  double mean = par_sum / N;            // вычисляю среднее значение массива
  double var  = par_sq / N - mean*mean; // вычисляю дисперсию

  cout.setf(std::ios::fixed);           // включаю фиксированный формат вывода
  cout << setprecision(6);              // задаю точность вывода чисел
  cout << "N=" << N << "\n";             // вывожу размер массива
  cout << "seq_time=" << seq_time << " s\n"; // вывожу время последовательной версии
  cout << "par_time=" << par_time << " s\n"; // вывожу время параллельной версии
  cout << "speedup=" << seq_time / par_time << "\n"; // вывожу ускорение
  cout << "mean=" << mean << "\n";       // вывожу среднее значение
  cout << "variance=" << var << "\n";    // вывожу дисперсию
  cout << "threads=" << omp_get_max_threads() << "\n"; // вывожу число потоков

  return 0;                              // корректное завершение программы
}
